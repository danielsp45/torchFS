#!/usr/bin/env bash

set -Eeuo pipefail

# Determine the directory of the script and move to the project root.
BASE_DIR=$(dirname "${BASH_SOURCE[0]:-$0}")
cd "${BASE_DIR}/.." || exit 127

function display_help() {
  cat <<EOF
Usage: $(basename "$0") [options]

This script cleans the C++ build directory by removing it entirely.
Options:
  -h, --help      Show this help message.
EOF
}

# Check for help flags.
if [[ "${1:-}" == "-h" || "${1:-}" == "--help" ]]; then
  display_help
  exit 0
fi

BUILD_DIR="build"

if [[ -d "${BUILD_DIR}" ]]; then
  echo "Cleaning build directory: ${BUILD_DIR}"

  # Find and remove everything except the vcpkg_installed directory
  find "${BUILD_DIR}" -mindepth 1 -maxdepth 1 ! -name 'vcpkg_installed' -exec rm -rf {} + || { echo "Failed to clean build directory"; exit 1; }

  echo "Clean completed successfully."
else
  echo "Build directory does not exist; nothing to clean."
fi